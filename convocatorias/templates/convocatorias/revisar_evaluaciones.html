{% extends "base.html" %}
{% load custom_filters %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">üßê Revisi√≥n de Evaluaciones - {{ postulacion.titulo }}</h2>

    <p><strong>üé¨ Postulado por:</strong> {{ postulacion.nombre_productor }}</p>

    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>üßë Evaluador</th>
                <th>‚úÖ ¬øEvalu√≥?</th>
                <th>üìå Recomendaci√≥n</th>
                <th>üí¨ Comentario</th>
                <th>üîî Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for asignacion in asignaciones %}
                {% with evaluacion=evaluaciones_dict|get_item:asignacion.evaluador.id %}
                <tr>
                    <td>{{ asignacion.evaluador.usuario.get_full_name }}</td>
                    <td>
                        {% if evaluacion %}
                            ‚úÖ S√≠
                        {% else %}
                            ‚ùå No
                        {% endif %}
                    </td>
                    <td>
                        {% if evaluacion %}
                            {% if evaluacion.recomendacion == 'si' %}
                                ‚úÖ S√≠
                            {% elif evaluacion.recomendacion == 'no' %}
                                ‚ùå No
                            {% elif evaluacion.recomendacion == 'discusion' %}
                                ‚ö†Ô∏è Discusi√≥n
                            {% else %}
                                <em>Sin recomendaci√≥n</em>
                            {% endif %}
                        {% else %}
                            <em>No ha enviado evaluaci√≥n</em>
                        {% endif %}
                    </td>
                    <td class="comentario-completo">
                        {% if evaluacion and evaluacion.comentario %}
                            {{ evaluacion.comentario }}
                        {% else %}
                            <em>No ha enviado evaluaci√≥n</em>
                        {% endif %}
                    </td>
                    <td>
                        {% if evaluacion %}
                            <!-- Bot√≥n de notificaci√≥n -->
                            <a class="btn btn-warning btn-sm">üîî Notificar Evaluador</a>
                        {% endif %}
                    </td>
                </tr>
                {% endwith %}
            {% endfor %}
            </tbody>
    </table>

    <form method="post">
        {% csrf_token %}
        <div class="form-group mt-4">
            <label for="comentario_final"><strong>üìù Comentario Final:</strong></label>
            <textarea name="comentario_final" id="comentario_final" class="form-control" rows="4">{{ postulacion.comentario_final }}</textarea>
        </div>

        <div class="mt-3">
            <a href="{% url 'detalle_acta' acta.id %}" class="btn btn-secondary">‚Üê Volver al Detalle del Acta</a>
            <button type="submit" class="btn btn-success float-end">‚úÖ Aprobar/Rechazar Postulaci√≥n</button>
        </div>
    </form>
</div>
{% endblock %}
