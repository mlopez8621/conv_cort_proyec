{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">Verificaci√≥n de Postulaci√≥n</h2>

    <!-- üîπ Informaci√≥n principal -->
    <div class="card shadow-sm p-4 mb-4">
        <h3 class="text-primary">{{ postulacion.titulo }}</h3>
        <p><strong>Correo del Productor:</strong> <a href="mailto:{{ postulacion.correo_productor }}">{{ postulacion.correo_productor }}</a></p>
        <p><strong>Estado Actual:</strong> 
            <span class="badge 
                {% if postulacion.estado == 'evaluacion' %} bg-warning text-dark 
                {% elif postulacion.estado == 'rechazado' %} bg-danger
                {% elif postulacion.estado == 'aceptado' %} bg-success
                {% else %} bg-secondary
                {% endif %}">
                {{ postulacion.get_estado_display }}
            </span>
        </p>
    </div>

    <!-- üîπ Secci√≥n de Detalles -->
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm p-4 mb-4">
                <h4>Detalles del Cortometraje</h4>
                <ul class="list-group">
                    <li class="list-group-item"><strong>A√±o de Producci√≥n:</strong> {{ postulacion.anio_produccion }}</li>
                    <li class="list-group-item"><strong>Duraci√≥n:</strong> {{ postulacion.duracion }}</li>
                    <li class="list-group-item"><strong>G√©nero:</strong> {{ postulacion.get_genero_cortrometraje_display }}</li>
                    <li class="list-group-item"><strong>Subg√©nero:</strong> {{ postulacion.get_subgenero_cortrometraje_display }}</li>
                    {% if postulacion.subgenero_cortrometraje == "otro" %}
                        <li class="list-group-item"><strong>Otro Subg√©nero:</strong> {{ postulacion.otro_subgenero_cortrometraje }}</li>
                    {% endif %}
                    <li class="list-group-item"><strong>Formato de Grabaci√≥n:</strong> {{ postulacion.formato_grabacion }}</li>
                    <li class="list-group-item"><strong>Locaciones del Rodaje:</strong> {{ postulacion.locaciones_rodaje }}</li>
                </ul>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm p-4 mb-4">
                    <h4>Sinopsis</h4>
                    <p>{{ postulacion.sinopsis_corta }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm p-4 mb-4">
                <h4>Historial y Exhibici√≥n</h4>
                <ul class="list-group">
                    <li class="list-group-item"><strong>¬øBeneficiario del FDC?:</strong> {{ postulacion.get_beneficiario_fdc_display }}</li>
                    {% if postulacion.beneficiario_fdc == "si" %}
                        <li class="list-group-item"><strong>A√±o del Beneficio:</strong> {{ postulacion.anio_fdc }}</li>
                    {% endif %}
                    <li class="list-group-item"><strong>¬øEl corto ha estado en otras plataformas?:</strong> {{ postulacion.get_plataformas_exhibicion_display }}</li>
                    {% if postulacion.plataformas_exhibicion == "otro" %}
                        <li class="list-group-item"><strong>Plataformas:</strong> {{ postulacion.si_plataforma }}</li>
                    {% endif %}
                    <li class="list-group-item"><strong>¬øPostulado anteriormente?:</strong> {{ postulacion.get_postulado_antes_display }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- üîπ Resoluci√≥n y Autorizaciones -->
    <div class="card shadow-sm p-4 mb-4">
        <h4>Resoluci√≥n y Autorizaciones</h4>
        <ul class="list-group">
            <li class="list-group-item"><strong>N√∫mero de Resoluci√≥n CPN:</strong> {{ postulacion.resolucion_cpn }}</li>
            <li class="list-group-item"><strong>Fecha de Resoluci√≥n CPN:</strong> {{ postulacion.fecha_resolucion_cpn }}</li>
        </ul>
    </div>

    <!-- üîπ Enlaces del Corto -->
    <div class="card shadow-sm p-4 mb-4">
        <h4>Enlaces del Corto</h4>
        {% if postulacion.enlace_vimeo %}
            <p><strong>Enlace Vimeo:</strong> <a href="{{ postulacion.enlace_vimeo }}" class="btn btn-primary btn-sm" target="_blank">Ver Corto</a></p>
        {% endif %}
        {% if postulacion.contrasena_vimeo %}
            <p><strong>Contrase√±a Vimeo:</strong> <code>{{ postulacion.contrasena_vimeo }}</code></p>
        {% endif %}
    </div>

    <!-- üîπ Documentos Adjuntos -->
    <div class="card shadow-sm p-4 mb-4">
        <h4>Documentos Adjuntos</h4>
        <div class="row row-cols-1 row-cols-md-2 g-3">
            {% if postulacion.certificacion_fdc %}
            <div class="col">
                <div class="card border-0 shadow-sm p-2">
                    <a href="{{ postulacion.certificacion_fdc.url }}" class="btn btn-outline-secondary btn-block" target="_blank">
                        üìÑ Certificaci√≥n FDC
                    </a>
                </div>
            </div>
            {% endif %}
            {% if postulacion.certificacion_cpn %}
            <div class="col">
                <div class="card border-0 shadow-sm p-2">
                    <a href="{{ postulacion.certificacion_cpn.url }}" class="btn btn-outline-secondary btn-block" target="_blank">
                        üìú Certificaci√≥n CPN
                    </a>
                </div>
            </div>
            {% endif %}
            {% if postulacion.acta_clasificacion %}
            <div class="col">
                <div class="card border-0 shadow-sm p-2">
                    <a href="{{ postulacion.acta_clasificacion.url }}" class="btn btn-outline-secondary btn-block" target="_blank">
                        üèõÔ∏è Acta de Clasificaci√≥n
                    </a>
                </div>
            </div>
            {% endif %}
            {% if postulacion.autorizacion_uso %}
            <div class="col">
                <div class="card border-0 shadow-sm p-2">
                    <a href="{{ postulacion.autorizacion_uso.url }}" class="btn btn-outline-secondary btn-block" target="_blank">
                        üîè Autorizaci√≥n de Uso
                    </a>
                </div>
            </div>
            {% endif %}
            {% if postulacion.certificacion_cumplimiento %}
            <div class="col">
                <div class="card border-0 shadow-sm p-2">
                    <a href="{{ postulacion.certificacion_cumplimiento.url }}" class="btn btn-outline-secondary btn-block" target="_blank">
                        ‚úÖ Certificaci√≥n de Cumplimiento
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    

    <!-- üîπ Comentario del Administrador -->
    <div class="card shadow-sm p-4 mb-4">
        <h4>Comentario del Administrador</h4>
        <form method="POST">
            {% csrf_token %}
            <textarea name="comentario_admin" class="form-control" rows="4" placeholder="Motivo del rechazo o comentario..."></textarea>
            <br>
            <div class="d-flex gap-2">
                <button type="submit" name="aprobar" class="btn btn-success">‚úÖ Aprobar y Enviar a Evaluaci√≥n</button>
                <button type="submit" name="rechazar" class="btn btn-danger">‚ùå Rechazar Postulaci√≥n</button>
            </div>
        </form>
    </div>

    <a href="{% url 'lista_postulaciones_admin' %}" class="btn btn-dark">üîô Volver</a>
</div>
{% endblock %}
